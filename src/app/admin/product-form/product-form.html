<div class="row">
  <div class="col-md-6">
    <form class="p-3" #productForm="ngForm" (ngSubmit)="saveProduct(productForm)" novalidate>
      <!-- Title -->
      <div class="input-group mb-3">
        <span class="input-group-text">Title</span>
        <input
          type="text"
          class="form-control"
          name="title"
          [(ngModel)]="product.title"
          required
          minlength="3"
          #title="ngModel"
          [class.is-invalid]="title.invalid && title.touched"
        />
      </div>
      <div class="text-danger" *ngIf="title.invalid && title.touched">
        <small *ngIf="title.errors?.['required']">Title is required</small>
        <small *ngIf="title.errors?.['minlength']"> Title must be at least 3 characters </small>
      </div>

      <!-- Price -->
      <div class="input-group mb-3">
        <span class="input-group-text">$</span>
        <input
          type="number"
          class="form-control"
          name="price"
          [(ngModel)]="product.price"
          required
          min="0.01"
          step="0.01"
          #price="ngModel"
          [class.is-invalid]="price.invalid && price.touched"
        />
      </div>
      <div class="text-danger" *ngIf="price.invalid && price.touched">
        <small *ngIf="price.errors?.['required']">Price is required</small>
        <small *ngIf="price.errors?.['min']">Price must be greater than 0</small>
      </div>

      <!-- Category -->
      <div class="input-group mb-3">
        <label class="input-group-text">Category</label>
        <select
          class="form-select"
          name="categoryId"
          [(ngModel)]="product.categoryId"
          required
          #categoryId="ngModel"
          [class.is-invalid]="categoryId.invalid && categoryId.touched"
        >
          <option value="" disabled selected>Select category</option>
          <option *ngFor="let c of categories" [value]="c.id">
            {{ c.description }}
          </option>
        </select>
      </div>
      <div class="text-danger" *ngIf="categoryId.invalid && categoryId.touched">
        <small>Category is required</small>
      </div>

      <!-- Image URL -->
      <div class="input-group mb-3">
        <span class="input-group-text">Image URL</span>
        <input
          type="url"
          class="form-control"
          name="imageUrl"
          [(ngModel)]="product.imageUrl"
          pattern="https?://.+"
          #imageUrl="ngModel"
          [class.is-invalid]="imageUrl.invalid && imageUrl.touched"
        />
      </div>
      <div class="text-danger" *ngIf="imageUrl.invalid && imageUrl.touched">
        <small *ngIf="imageUrl.errors?.['required']">Image URL is required</small>
        <small *ngIf="imageUrl.errors?.['pattern']"> Enter a valid URL (http/https) </small>
      </div>

      <!-- Buttons -->
      <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary flex-grow-1" [disabled]="productForm.invalid">
          Save
        </button>

        <!-- Delete button - only shown when editing an existing product -->
        <button
          *ngIf="product.id"
          type="button"
          class="btn btn-danger"
          (click)="deleteProduct(product.id!)"
        >
          Delete
        </button>
      </div>
    </form>
  </div>
  <div *ngIf="title.value" class="col-md-6">
    <div class="card" style="width: 18rem">
      <img
        [src]="
          imageUrl.value ||
          'https://st2.depositphotos.com/2586633/46477/v/450/depositphotos_464771766-stock-illustration-no-photo-or-blank-image.jpg'
        "
        class="card-img-top"
        alt="..."
      />
      <div class="card-body">
        <h5 class="card-title">{{ title.value }}</h5>
        <p class="card-text">${{ price.value | currency : 'USD' : 'symbol' : '1.2-2' }}</p>
      </div>
    </div>
  </div>
</div>
