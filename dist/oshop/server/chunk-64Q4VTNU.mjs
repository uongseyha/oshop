import './polyfills.server.mjs';
import{J as C,n as p,v as b}from"./chunk-IL75KJFX.mjs";import{$ as m,Ia as l,T as h,W as i,da as u,g as o,p as n,t as c}from"./chunk-RSKEQSSP.mjs";var f=class a{constructor(t,e){this.http=t;this.platformId=e;this.isBrowser=p(e)}baseUrl=`${C.apiUrl}/Carts`;cartKey="cartId";isBrowser=!1;cartQuantitySubject=new o(0);cartQuantity$=this.cartQuantitySubject.asObservable();checkoutCartSubject=new o(null);checkoutCart$=this.checkoutCartSubject.asObservable();createCart(){return this.http.post(this.baseUrl,{})}getCartId(){return Number(localStorage.getItem(this.cartKey))}setCartId(t){localStorage.setItem(this.cartKey,t.toString())}getCart(t){return this.http.get(`${this.baseUrl}/${t}`).pipe(i(e=>{let r=e.items.reduce((s,g)=>s+g.quantity,0);this.cartQuantitySubject.next(r),this.checkoutCartSubject.next(e)}))}addItem(t,e,r){return this.http.post(`${this.baseUrl}/${t}/items`,{productId:e,quantity:r}).pipe(h(()=>this.getCart(t)))}removeItem(t,e){return this.http.delete(`${this.baseUrl}/${t}/items/${e}`).pipe(i(()=>this.getCart(t).subscribe()))}getProductQuantity(t,e){return this.getCart(t).pipe(c(r=>r.items.find(s=>s.productId===e)?.quantity??0))}getOrCreateCart(){if(this.isBrowser){let t=localStorage.getItem(this.cartKey);if(t)return n(+t)}return this.http.post(this.baseUrl,{}).pipe(i(t=>{this.isBrowser&&localStorage.setItem(this.cartKey,t.id.toString())}),c(t=>t.id))}updateItem(t,e,r){return this.http.post(`${this.baseUrl}/${t}/items`,{productId:e,quantity:r})}setCheckoutCart(t){this.checkoutCartSubject.next(t),this.isBrowser&&localStorage.setItem("checkout_cart",JSON.stringify(t))}getCheckoutCart(){if(this.checkoutCartSubject.value)return this.checkoutCartSubject.value;if(this.isBrowser){let t=localStorage.getItem("checkout_cart");return t?JSON.parse(t):null}return null}clearCheckoutCart(){this.checkoutCartSubject.next(null),this.isBrowser&&localStorage.removeItem("checkout_cart")}static \u0275fac=function(e){return new(e||a)(u(b),u(l))};static \u0275prov=m({token:a,factory:a.\u0275fac,providedIn:"root"})};export{f as a};
